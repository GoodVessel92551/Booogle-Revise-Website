{% extends "base.html" %} {% block title %}AI Revise{% endblock %} {% block
main %}
<div class="ai_quesitons" id="ai_quesitons">
</div>
<div class="ai_container">
    <input autofocus autocomplete="off" id="prompt" type="text" placeholder="Topic" class="text ai_text_input">
    <button id="button" class="main_button"><span>Generate</span><ion-icon name="sparkles-outline"></ion-icon></button>
</div>
<script>
    var quesitons = document.getElementById("ai_quesitons");
    var prompt = document.getElementById("prompt");
    var button = document.getElementById("button");
    var generating = false
    var messages = []
    var topic = ""
    url = "/ai/revise/generate"
    const gen = (() => {
        generating = true;
        prompt.placeholder = "Write Here";
        var chatbox = document.createElement("a");
        var prompt_is = prompt.value
        messages.push(prompt_is)
        chatbox.innerText = prompt_is;
        prompt.value = "";
        quesitons.appendChild(chatbox);
        data = {
            "prompt":prompt_is,
            "messages":messages,
            "topic":topic
        }
        fetch(url, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            })
            .then(response => response.json())
                .then(data => {
                    var ans = document.createElement("span");
                    var words = data["ans"].split(" ");
                    chatbox.appendChild(ans);
                    ans.innerText = words[0];
                    for(var i=1;i<words.length;i++){
                        (function(j) {
                            setTimeout(() => {
                              ans.innerText += " " + words[j];
                                if (j == words.length - 1){
                                    generating = false
                                }
                            }, 60 * j);
                          })(i);
                    }
                    console.log(data["ans"])
              })
              .catch(error => {
                    console.log(error);
              });
    })
    
    prompt.addEventListener("keyup",(e) => {
        if(e.key == "Enter" && prompt.value != "" && !generating){
            gen();
        }
    })
</script>
{% endblock %}
